{% extends 'base/base_registered.html' %}
<!--To load the Django library to translate your text.-->
{% load i18n %}

{% load static %}

{% block content %} 

<body>

<!-- Page content-->
<div class="row">
  <div class="text-left card col-lg-3">
    <ul>
    <h4 class="mt-2">
      <!--Para poder meterlle a variable country teño que escribir a url deste xeito-->
      WEEK {{current_week_html}} - Day {{ journey_day_html }}<img style="float: right;" width="75" height="37" src='{{flag_url_html}}' alt="First slide">
    </h4>
    <hr>
      <li id="data_home_page">Km completed: <strong>{{ total_km_html }} km </strong></li>
      <li id="data_home_page" class="mt-2">Total Expenses: <strong>{{ graph_total_money_html }} € </strong></li>
      <li id="data_home_page" class="mt-2">Country: <strong>{{ current_country_html }} (#{{country_number_html}})</strong></li>
      <li id="data_home_page" class="mt-2">Capital: <strong>{{ capital_city_html }}</strong></li>
      <li id="data_home_page" class="mt-2">Visa required: <strong>{{ visa_required_html }} ({{ visa_price_html }} Euros)</strong></li>
    <hr>
    <h5>Country Information:</h5>
    <hr>
      <li id="data_home_page" class="mt-3">Surface: <strong>{{ surface_html }} km2 </strong><br> 
        <label style="font-style: italic;">(Spain: 505.994 km2)</label></li>
      <li id="data_home_page" class="mt-2">Population: <strong>{{ population_html }} people </strong> <br>
        <label style="font-style: italic;">(Spain: 48.300.000 people)</label></li>
      <li id="data_home_page" class="mt-2">Density population: <strong>{{ density_population_html }} km2 </strong> <br>
        <label style="font-style: italic;">(Spain: 94 people per km2)</label> </li>
      <li id="data_home_page" class="mt-2">Renta per capita: <strong>{{ rent_per_capita_html }} €</strong> <br>
        <label style="font-style: italic;">(Spain: 27.870 €)</label> </li>
      <li id="data_home_page" class="mt-2">Currency: <strong>{{ currency_html }}</strong> </li>
      <li id="data_home_page" class="mt-2">Local Time: <strong><label id="current-time"></label></strong> </li>
      <li id="data_home_page" class="mt-2">The most listen song on Spotify</li>
    </ul>
  </div>
  <div class="col-lg-9">
    <iframe src="https://www.komoot.es/tour/947537380/embed?profile=1" width="100%" height="650" frameborder="0" scrolling="no"></iframe>
  </div>
</div>
  <!--ESTO É CÓDIGO DE JAVASCRIPT PARA CREAR UN RELOXO-->
  <!--The timezones are get from this page (zone ID column): https://nodatime.org/TimeZones-->
  <script>
    let time = document.getElementById("current-time");
    setInterval(()=>{
      let d = new Date();
      time.innerHTML = d.toLocaleTimeString('en-US', {timeZone: "{{time_zone_html}}", timeZoneName: "short", hour12: false })
    },1000)
  </script>

<!--CHAT AREA-->
<!-- Main Body -->
<section>
  <div class="container mt-12">
    <div class="row">
      <div class="col-sm-12 col-md-12 col-12 pb-12 mt-4">
        <form method="post" novalidate>
          {% csrf_token %}
          <div class="form-group">
            <h3 style="color: white">Anything you want to say or ask me?</h3>
              {{ chat_form_html.comentario }}
              {% if messages %}
                <label id="label_error" style="color: red;">{{ chat_form_html.comentario.errors }}</label>
              {% endif %}
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-outline-light mt-2" id="button_postcomment" href=""><strong>Post Comment</strong></button>
          </div>
        </form>
      
        <h4 style="color: white">Comments ({{chat_number_comments_html}})</h4>
          <div class="comment mt-4 text-justify float-left" id="chat_box">
            {% for chat_comments in chat_comments_all_html %}
              <h6 style="color: rgba(191, 191, 191, 1)">
                  <img src="/static/pictures/bike_avatars/touring_bike.jpg" alt="" class="rounded-circle" width="50" height="50">
                  <strong> {{ chat_comments.username_comment }}</strong> - {{ chat_comments.date_added }}
              </h6>
              <p style="color: rgba(191, 191, 191, 1)">{{ chat_comments.comentario }}</p>
              <!--When the button is clicked, the input field in the modal section (id=comment-pk) is going to be auto-populated with the chat_comments.pk
                  thanks to the function created in javascript (setCommentPK)-->
              <label onclick="setCommentPK( {{chat_comments.pk}} )"" data-toggle="modal" data-target="#exampleModalCenter" data-comment-pk="{{ chat_comments.pk }}" style="color: white;">Reply </label>
                <p style="color: white;">See all replies ({{chat_comments.number_of_replies}})</p>
                {% for reply in replies_comments_all_html %}
                <!--string format is to convert and ensure both values are strings, because if they do not have the same type, a igualdade non funciona-->
                {% if chat_comments.pk|stringformat:"s" == reply.pk_original_comment|stringformat:"s" %}
                  <p style="color: white;">{{ reply.reply_text }}</p>
                {% endif %}
              {% endfor %}
            {% endfor %}
            

<!-- Modal for replies -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div id="delete_account_section" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Write your reply for Comment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>Write your reply</label>
                <form class="mx-1 mx-md-4 mt-3" method="POST" action="" novalidate>
                    {% csrf_token %}
                    <!--IMPORTANTE: o que está facendo o input eiqui é autopopulando o 'pk_original_comment' field do formulario 'chat_replies_form'
                      Ten type='hidden' porque non quero que se mostre-->
                    <input type="hidden" name="pk_original_comment" id="comment-pk">
                    <!--Deixo o {{ form_chat_reply_html.pk_original_comment }} comentado para que sepas que o chat_comments.pk estase a gardar aí.-->
                    <!--{{ form_chat_reply_html.pk_original_comment }}-->
                    {{ form_chat_reply_html.reply_text }}
                    <button type="submit" class="btn btn-danger mt-3">Reply</button>
                    <button type="button" class="btn btn-secondary mt-3" data-dismiss="modal">Cancel</button>
                </form>
            </div>
        </div>
    </div>
</div>

</body>

<!--This is the javascript function which captures the chat_comments.pk when the "Reply" button is clicked.-->
<script>
  function setCommentPK(pk) {
      document.getElementById('comment-pk').value = pk;
  }
</script>



{% endblock content %}



